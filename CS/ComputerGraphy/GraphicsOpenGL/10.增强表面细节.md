
## 凹凸贴图
修改法向量以呈现“凸起”效果
插值法向量
在运行时使用数学函数对法向量进行计算，称为**过程式凹凸贴图**
## 法线贴图
图像中的 R、G、B 值以字节形式存储，通常被解释为[0,1]区间内的值，但是向量可以有正负值分量。如果我们将法向量分量限制在[−1,+1]区间内，需要将法向量 N 存储为像素颜色的简单转换。

法线图最终看起来基本都是蓝色的，这是因为图像文件中每个像素的 B 值（蓝色值）都是 1（最大值），这会让它在作为图像时看起来是“蓝色的”。

从法线图查找到的法向量不能直接使用，因为它们是相对于上述的任意平面定义的，并没有考虑法向量在物体上的位置以及在相机空间中的方向。这个问题的解决策略是建立一个转换矩阵，用于将法向量转换到相机空间。

切向量与顶点、纹理坐标以及法向量一样，是从缓冲区（VBO）传递到顶点着色器中的顶点属性。逆转置矩阵的应用将法向量和切向量转换到相机空间，我们随后使用叉积构造副切向量。

我们一旦在相机空间中得到法向量、切向量和副切向量，就可以使用它们来构造矩阵（称为TBN 矩阵）。该矩阵用于将从**法线贴图中检索到的法向量**转换为在**相机空间中相对于物体表面的法向量**。

```glsl
//从法线贴图读取法向量，再转换到正确的区间，再转换到相机空间
vec3 calcNewNormal()
{ vec3 normal = normalize(varyingNormal);
vec3 tangent = normalize(varyingTangent);
tangent = normalize(tangent - dot(tangent, normal) * normal); // 切向量垂直于法向量
vec3 bitangent = cross(tangent, normal);
mat3 tbn = mat3(tangent, bitangent, normal); // 用来变换到相机空间的 TBN 矩阵
vec3 retrievedNormal = texture(normMap,tc).xyz;
retrievedNormal = retrievedNormal * 2.0 - 1.0; // 从 RGB 空间转换
vec3 newNormal = tbn * retrievedNormal;
newNormal = normalize(newNormal);
return newNormal;

}
```

法线贴图也可以使用多级渐远纹理贴图改善效果

法线贴图可以影响漫反射和镜面反射效果，但它无法投射阴影。因此，当表面特征尺寸较小时，更适合使用法线贴图。
## 高度贴图
扰动顶点本身的位置

## 补充说明
凹凸贴图或法线贴图的一个基本限制是，虽然它们能够在所渲染对象的内部提供表面细节，但是物体轮廓（外边界）无法显示这些细节（仍保持平滑）。
高度贴图在用于实际修改顶点位置时修复了这个缺陷，但它也有其自身的局限性。有时可以使用几何着色器或曲面细分着色器来增加顶点的数量，使高度贴图更加实用、有效。

## 习题
### 修改探索
### 绘制并使用高度图，观察无法重复采用的细节

### 给高度图生成的地形，添加光照
### 给高度图生成的地形添加阴影