[M3: 系统调用 Profiler (sperf)](https://jyywiki.cn/OS/2025/labs/M3.md)

## 目标 **实现系统调用 Profiler**
实现一个命令行工具，它能启动另一个程序，并统计该程序中各个系统调用的占用时间。对于较短时间运行的程序，你可以一次性打印出耗时最多的几个系统调用。对于耗时较长的程序，你需要保证每秒大约**打印 10 次** (不要过多) 系统调用的耗时信息。

## 相关指南
strace 获得软件在运行过程中的系统调用 和 trace

1. 使用 `fork` 创建一个新的进程；
2. 子进程使用 execve 调用 `strace COMMAND ARG...`，启动一份 strace；注意在 execve 成功返回以后，子进程已经不再受控制了，strace 会不断输出系统调用的 trace，直到程序结束。程序不结束 strace 也不会结束；
3. 父进程想办法不断读取 strace 的输出，直到 strace 程序结束，读取到输出后，如果距离上次输出已经超过 100ms，就把统计信息打印到屏幕上。

### 问题
- **为什么要使用 `fork` 创建新进程？**
    - 主要为了**隔离父子进程的职责**，让父进程能继续执行监控和统计逻辑，而子进程则专门运行 `strace` 命令。这实现了**并行执行**。
- **父子进程如何协作实现功能？**
    - **子进程**通过 `execve` 成为 `strace`，负责跟踪目标程序的系统调用并**将结果输出到标准输出**。
    - **父进程**则负责**读取子进程（`strace`）的输出**（通常通过管道），解析这些数据，然后进行实时统计和周期性地打印结果。