# 数学基础

## 点和矢量
在图形变换中，点和矢量是非常基础的概念。点代表空间中的位置，而矢量则代表方向和距离。它们的区分在矩阵变换中至关重要。

## 矩阵

## 矩阵变换

### 平移矩阵
平移矩阵用于在三维空间中移动一个点或对象。通过在齐次坐标系中加入平移量，可以方便地控制对象在各个轴向上的移动。对于三维空间的平移矩阵，它的形式如下：

```
| 1  0  0  Tx |
| 0  1  0  Ty |
| 0  0  1  Tz |
| 0  0  0  1  |
```
其中，`Tx`、`Ty` 和 `Tz` 分别表示沿 X、Y 和 Z 轴的平移量。

平移变换后，三维点 (x, y, z) 变为 (x + Tx, y + Ty, z + Tz)。

### 缩放矩阵
缩放矩阵用于沿各个轴对对象进行缩放。通过乘以缩放因子，物体会在空间中变大或缩小。三维空间的缩放矩阵形式为：

```
| Sx  0   0   0 |
| 0   Sy  0   0 |
| 0   0   Sz  0 |
| 0   0   0   1 |
```
其中，`Sx`、`Sy` 和 `Sz` 分别是沿 X、Y 和 Z 轴的缩放因子。如果缩放因子大于 1，物体变大；如果缩放因子小于 1，物体缩小。

缩放后的三维点 (x, y, z) 变为 (x * Sx, y * Sy, z * Sz)。

### 旋转矩阵
旋转矩阵用于围绕特定轴旋转对象。常见的三维旋转矩阵有绕 X、Y、Z 轴的旋转矩阵，它们的表示如下：

- **绕 X 轴旋转：**

```
| 1   0          0         0 |
| 0   cos(θ)   -sin(θ)    0 |
| 0   sin(θ)    cos(θ)    0 |
| 0   0          0         1 |
```

- **绕 Y 轴旋转：**

```
|  cos(θ)   0   sin(θ)   0 |
|    0      1     0      0 |
| -sin(θ)   0   cos(θ)   0 |
|    0      0     0      1 |
```

- **绕 Z 轴旋转：**

```
| cos(θ)   -sin(θ)   0   0 |
| sin(θ)    cos(θ)   0   0 |
|   0         0      1   0 |
|   0         0      0   1 |
```

其中，θ 为旋转角度（通常以弧度表示），旋转矩阵会将物体沿对应轴旋转。

## 复合变换和变换顺序

### 复合变换
复合变换是通过矩阵乘法将多个变换组合起来的方式。通过将平移、旋转、缩放等矩阵依次相乘，可以实现一系列复杂的变换。

### 变换顺序
在矩阵乘法中，变换的顺序非常重要，因为矩阵乘法是不交换的（即 AB ≠ BA）。  
- **常见的变换顺序**：通常，先执行缩放，再旋转，最后平移。这是因为缩放和旋转会影响对象的方向和大小，而平移只影响对象的位置。
- **旋转顺序**：在 Unity 中，常用的旋转顺序为 YXZ。这意味着，旋转是按照 Y 轴、X 轴、Z 轴的顺序依次进行的。

## 渲染流水线中的顶点变换

在 Unity 的渲染流水线中，顶点需要经过一系列坐标空间变换，最终映射到屏幕上。这些变换可以总结为以下几个关键空间：

- **模型空间**：最初的顶点坐标，相对于对象自身的位置。
- **世界空间**：顶点被放置在整个场景中的位置。
- **观察空间**：顶点相对于摄像机的位置。
- **齐次裁剪空间**：经过投影变换后的空间，方便裁剪。
- **屏幕空间**：最终显示在屏幕上的像素坐标。

每一个坐标空间的变换都有其特定的意义和用途。例如：
- 在 **模型空间** 进行顶点动画计算。
- 在 **世界空间** 计算光照。
- 在 **裁剪空间** 进行裁剪操作（硬件加速）。

## 模型空间 (Model Space)
模型空间也称为对象空间（Object Space）或局部空间（Local Space）。在这个空间中，顶点的坐标是相对于对象本身的坐标原点的。

## 世界空间 (World Space)
世界空间是场景中的绝对坐标系。其原点通常定义为整个场景的 (0, 0, 0) 点，坐标轴则为世界的 XYZ 轴。通过模型变换矩阵，模型空间中的顶点可以被变换到世界空间。

## 观察空间 (View Space)
观察空间（或摄像机空间）是相对于摄像机视角的空间。其原点位于摄像机的位置，坐标轴是摄像机的局部坐标轴。通过观察矩阵，将顶点从世界空间变换到观察空间。

## 裁剪空间 (Clip Space)
齐次裁剪空间是为了方便硬件进行裁剪计算。顶点通过投影矩阵从观察空间变换到裁剪空间。视锥体（frustum）决定了裁剪空间的形状，常见的投影类型包括：
- **正交投影**：保持对象尺寸不变。
- **透视投影**：随着距离的增加，对象的尺寸缩小。

投影变换不仅实现了三维到二维的降维操作，还对对象进行了缩放调整。

## 屏幕空间 (Screen Space)
屏幕空间是二维空间，表示每个顶点在屏幕上的像素位置。顶点从裁剪空间到屏幕空间的变换包括：
- **齐次除法**：将齐次坐标中的 W 分量归一化。
- **屏幕坐标计算**：根据视口的大小和分辨率，将顶点坐标转换为实际的像素坐标。

---

通过这些空间的转换，一个三维物体最终可以被正确绘制到屏幕上。每个空间都有其计算的意义，理解这些变换过程能够帮助更好地掌握 Shader 和渲染技术。