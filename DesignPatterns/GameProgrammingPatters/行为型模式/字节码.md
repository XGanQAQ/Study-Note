# 字节码

## 什么是字节码
字节码：是一种中间代码，通常是某种编程语言的编译器将源代码编译后的结果。例如，Java 的字节码是由 Java 编译器生成的，供 Java 虚拟机（JVM）执行。
编译器：
虚拟机：

### 解释器模式
用树状结构来表示语法规则，然后用递归的方式来解释这个树状结构
解释型语言的最简单结构
优点：简单，易于实现
缺点：慢

### 机器码
可以由高级语言编译而来
优点：快
缺点：不可移植，安全问题

### 虚拟机器码
编写一套字节码的逻辑，然后用你编写的虚拟机去执行这套字节码  
实现数据逻辑与执行逻辑的分离，实现了数据逻辑的数据化，这样就可以不用编译整个游戏，只需要修改文本数据，就可以实现新的游戏逻辑了。  
类似于解释器模式，但是解释器模式是解释文本数据，而虚拟机器码是解释字节码  
优点：数据逻辑与执行逻辑分离，实现了数据逻辑的数据化  
缺点：你需要自己实现语法逻辑，比较复杂，比解释器模式快，比机器码慢

## 为什么要用字节码
为了实现游戏的拓展不需要重新编译整个游戏  
我们使用解释器去解释文本数据，然后执行这些数据。
实现了逻辑数据化，这样就不用重新编译游戏，只需要修改文本数据，就可以实现新的游戏逻辑了

## 如何实现你的虚拟机器码/介绍了虚拟机器码的原理

### 自定义的基本API
用于将你的指令与引擎连接

### API对应的指令集

#### 应该有哪些指令
- 外部基本操作：操作引擎内部，虚拟机之外
- 内部基本操作：操作虚拟机内部值，如字面值，算数运算符，比较符
- 控制流：跳转
- 抽象化：重用字节码，函数调用，对象操作


### 线性执行指令的小型虚拟机

### 栈机记录数据

#### 指令如何访问堆栈
- 基于栈的虚拟机
- 基于寄存器的虚拟机

#### 值应当如何表示
- 单一数据类型
- 标签的一个变体
- 不带标签的联合体

### 语言转换工具
语言转换工具把高级的表达形式，转换为你的基本指令集，用于虚拟机执行。  
可以是图形化UI，文本数据，或者是其他的形式。

#### 如何生成字节码/如何选择语言转换工具
##### 基于文本的语言转换工具
- 定义语法
- 分析器
- 处理错误
- 操作难

##### 图形化编辑工具
- 实现图形化界面
- 不易出错，操作简单
- 可移植性差

## 总结
虚拟字节码是一种将数据逻辑与执行逻辑分离的方法，实现了数据逻辑的数据化，这样就不用重新编译整个游戏，只需要修改文本数据，就可以实现新的游戏逻辑了。  
它可以用来实现游戏的拓展，也可以用来实现游戏的脚本。  
图形化编程的原理其实就可以看作是一种虚拟机器码，只不过它是用图形化界面来实现的。把你图形的逻辑转换为字节码，再用解释器去执行这些字节码。